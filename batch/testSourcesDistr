#!/bin/sh
AMAYAVERSION=0.95b
THOTVERSION=2.0b

CC=gcc
CFLAGS=-O2
THOTTAPE=/tahiti/thottape
THOTDIR=/tahiti/diffusion/opera
MACHINE=`$THOTDIR/batch/MachineType`
TESTDIR=$HOME/tmp

if [ -f $TESTDIR/Thot ]
then
    echo Removing Old $TESTDIR/Thot
    echo mv $TESTDIR/Thot $TESTDIR/Thot.old
    echo rm -rf $TESTDIR/Thot.old
fi

echo Creating the Test directory
mkdir -p $TESTDIR
cd $TESTDIR
echo Extracting Thot library sources $THOTVERSION
tar xvzf $THOTTAPE/thot-src-$THOTVERSION.tar.gz
echo Extracting Thot libs $THOTVERSION for $MACHINE
tar xvzf $THOTTAPE/thot-libs-$MACHINE-$THOTVERSION.tar.gz
cd Thot
echo Extracting Thot Editor sources $THOTVERSION
tar xvzf $THOTTAPE/thoteditor-src-$THOTVERSION.tar.gz
echo Extracting Amaya sources $AMAYAVERSION
tar xvzf $THOTTAPE/amaya-src-$AMAYAVERSION.tar.gz
echo Extracting Amaya libs $THOTVERSION for $MACHINE
tar xvzf $THOTTAPE/amaya-libs-$MACHINE-$AMAYAVERSION.tar.gz
echo Going to $MACHINE specific directory
cd $MACHINE
echo Setting up Makefile
sed -e "s+/\^THOTDIR.*\$+THOTDIR=$TESTDIR/Thot+" < Makefile.orig > Makefile
echo Starting compile with CC=$CC CFLAGS=$CFLAGS
make CC=$CC CFLAGS=$CFLAGS amaya
